# Phase 1 Quick Start Guide

**Status**: Ready for Cursor Composer implementation
**Estimated Time**: 23.5 hours (28 hours with testing buffer)

## What's Been Created

I've created all the foundation files that Cursor Composer needs to implement Phase 1 of the accounting integration. Here's what you have:

### ğŸ“ File Structure

```
OTS-ERP/
â”œâ”€â”€ migrations/phase1/
â”‚   â”œâ”€â”€ 001_add_journal_entry_source.sql          âœ… Ready to execute
â”‚   â”œâ”€â”€ 001_add_journal_entry_source_rollback.sql âœ… Rollback ready
â”‚   â”œâ”€â”€ 002_add_vendor_invoice_table.sql          âœ… Ready to execute
â”‚   â””â”€â”€ 002_add_vendor_invoice_table_rollback.sql âœ… Rollback ready
â”‚
â”œâ”€â”€ src/lib/accounting/
â”‚   â”œâ”€â”€ types.ts                                   âœ… Complete type definitions
â”‚   â””â”€â”€ journal-entry-automation.ts                ğŸ”¨ Function stubs (Composer to implement)
â”‚
â”œâ”€â”€ src/lib/workflows/
â”‚   â”œâ”€â”€ invoice-automation.ts                      ğŸ”¨ Template (Composer to implement)
â”‚   â”œâ”€â”€ job-completion-automation.ts               ğŸ”¨ Template (Composer to implement)
â”‚   â”œâ”€â”€ po-receipt-automation.ts                   ğŸ”¨ Template (Composer to implement)
â”‚   â””â”€â”€ payroll-accrual-automation.ts              ğŸ”¨ Template (Composer to implement)
â”‚
â”œâ”€â”€ src/__tests__/accounting/
â”‚   â””â”€â”€ journal-entry-automation.test.ts           ğŸ”¨ Test template (Composer to implement)
â”‚
â””â”€â”€ docs/
    â”œâ”€â”€ COMPOSER_PROMPTS.md                        âœ… Ready-to-use prompts
    â”œâ”€â”€ PHASE_1_IMPLEMENTATION_GUIDE.md            âœ… Detailed specs
    â””â”€â”€ PHASE_1_QUICKSTART.md                      âœ… This file
```

**Legend**:
- âœ… Complete - Ready to use as-is
- ğŸ”¨ Template - Has structure, Composer fills in implementation

---

## How to Use This with Cursor Composer

### Step 1: Start with Task 1.1 (Migrations)

1. Open `docs/COMPOSER_PROMPTS.md`
2. Copy the **Task 1.1** prompt
3. Paste into Cursor Composer
4. Let Composer verify the migration files
5. When Composer confirms they're ready, I (Claude) will execute them

### Step 2: Implement Task 1.2 (Core Library)

1. Copy the **Task 1.2** prompt from COMPOSER_PROMPTS.md
2. Paste into Cursor Composer
3. Composer will implement:
   - `createAutoJournalEntry()` - Creates journal entries with source tracking
   - `findExistingJournalEntry()` - Prevents duplicates
   - `getAccountCode()` - Gets account codes from mapping
4. When done, I'll audit the implementation

### Step 3: Implement Workflows (Tasks 1.3, 1.4, 2.2, 2.3)

For each workflow, repeat:
1. Copy the task prompt
2. Paste into Composer
3. Composer implements the function
4. I audit the changes

**Workflows**:
- Task 1.3: Invoice â†’ Revenue (invoice-automation.ts)
- Task 1.4: Job â†’ COGS (job-completion-automation.ts)
- Task 2.2: PO â†’ AP (po-receipt-automation.ts)
- Task 2.3: Time â†’ Payroll (payroll-accrual-automation.ts)

### Step 4: Tests (Task 1.5)

1. Copy Task 1.5 prompt
2. Composer implements all skipped tests
3. Run: `npm test -- journal-entry-automation.test.ts`
4. I verify all tests pass

### Step 5: Verify Vendor Invoice Migration (Task 2.1)

1. Copy Task 2.1 prompt
2. Composer reviews/adjusts migration
3. I execute the migration

---

## My Role (Claude) in This Workflow

After each task Composer completes, I will:

1. **Audit the Code**
   - Review for correctness
   - Check error handling
   - Verify transaction safety
   - Ensure proper source tracking

2. **Execute Migrations**
   - Run migrations against your database
   - Verify schema changes
   - Test rollback scripts

3. **Run Tests**
   - Execute unit tests
   - Verify integration points
   - Check for edge cases

4. **Give Feedback**
   - Approve or request changes
   - Suggest optimizations
   - Identify potential issues

---

## What Each File Does

### Migration Files

**001_add_journal_entry_source.sql**
- Adds `sourceType`, `sourceId`, `autoGenerated` columns to JournalEntry table
- Creates indexes for efficient lookups
- Adds CHECK constraint for valid source types

**002_add_vendor_invoice_table.sql**
- Creates VendorInvoice table for AP tracking
- Links to vendors, purchase orders, and journal entries
- Tracks payment status and amounts

### Library Files

**types.ts**
- TypeScript type definitions for all automation functions
- Default account mapping (AR=1100, Revenue=4000, COGS=5000, etc.)
- Request/response interfaces

**journal-entry-automation.ts**
- Core automation engine
- `createAutoJournalEntry()` - Main function all workflows use
- `validateJournalEntry()` - Ensures debits = credits
- `findExistingJournalEntry()` - Duplicate prevention

### Workflow Files

**invoice-automation.ts**
- Triggers when invoice is created
- DR Accounts Receivable (1100)
- CR Revenue (4000)

**job-completion-automation.ts**
- Triggers when job is completed
- DR Labor/Material/Equipment Expense (5100/5000/5200)
- CR Inventory/WIP (1200)

**po-receipt-automation.ts**
- Triggers when PO is received
- DR Inventory (1200)
- CR Accounts Payable (2000)
- Creates VendorInvoice record

**payroll-accrual-automation.ts**
- Triggers when time is approved
- DR Labor Expense (5100)
- CR Wages Payable (2100)

---

## Database Tables Reference

These tables already exist in your database:

- **JournalEntry**: Main journal entry records
- **JournalEntryLine**: Individual debit/credit lines
- **Invoice**: Customer invoices
- **Job**: Jobs with status tracking
- **JobLaborCost**: Calculated labor costs per job
- **JobMaterialCost**: Calculated material costs per job
- **JobEquipmentCost**: Calculated equipment costs per job
- **PurchaseOrder**: Purchase orders to vendors
- **TimeEntry**: Employee time tracking
- **Vendor**: Vendor information

These will be created by migrations:
- **VendorInvoice**: AP tracking (Migration 002)

---

## Expected Timeline

| Task | Description | Time | Status |
|------|-------------|------|--------|
| 1.1 | Database migrations | 2h | âœ… Files ready |
| 1.2 | Core automation library | 4h | ğŸ”¨ Composer to implement |
| 1.3 | Invoice automation | 2h | ğŸ”¨ Composer to implement |
| 1.4 | Job completion automation | 3h | ğŸ”¨ Composer to implement |
| 1.5 | Unit tests | 3h | ğŸ”¨ Composer to implement |
| 2.1 | Vendor invoice table | 1.5h | âœ… Files ready |
| 2.2 | PO receipt automation | 2.5h | ğŸ”¨ Composer to implement |
| 2.3 | Payroll accrual | 2.5h | ğŸ”¨ Composer to implement |
| 2.4 | Integration testing | 3h | â¸ï¸ Pending |
| 2.5 | Deployment | 2h | â¸ï¸ Pending |

**Total**: 23.5 hours core + 5 hours for testing/deployment = **28.5 hours**

---

## Testing Strategy

After Composer implements each function, I'll verify:

1. **Validation Tests**
   - Journal entries balance (debits = credits)
   - Required fields present
   - No negative amounts

2. **Integration Tests**
   - Create test invoice â†’ Verify journal entry created
   - Complete test job â†’ Verify COGS entry created
   - Receive test PO â†’ Verify AP entry + VendorInvoice created
   - Approve test time â†’ Verify payroll accrual created

3. **Edge Cases**
   - Duplicate prevention (same source twice)
   - Transaction rollback on errors
   - Null/zero handling

---

## Common Issues & Solutions

### Issue: Migration fails due to missing columns
**Solution**: The JournalEntry table should already exist. If columns are missing, we'll add ALTER TABLE statements.

### Issue: Foreign key constraint fails
**Solution**: Migration 002 has FK constraints commented out. Composer will verify tables exist first.

### Issue: Tests can't connect to database
**Solution**: Ensure DATABASE_URL is set in .env for test environment.

### Issue: Journal entry doesn't balance
**Solution**: The `validateJournalEntry()` function will catch this before insertion.

---

## Next Steps

1. **Start with Task 1.1** - Let Composer verify migrations
2. **I'll execute migrations** to add source tracking
3. **Task 1.2** - Composer implements core library
4. **Tasks 1.3-2.3** - Composer implements workflows one by one
5. **Task 1.5** - Composer writes tests
6. **Task 2.4** - I run integration tests
7. **Task 2.5** - Deploy to production

---

## Questions?

If Composer gets stuck or needs clarification:
- Check `PHASE_1_IMPLEMENTATION_GUIDE.md` for detailed specs
- Reference the template files for structure
- Ask me (Claude) to clarify requirements

**Ready to start?** Copy the first prompt from `COMPOSER_PROMPTS.md` and let's go!
